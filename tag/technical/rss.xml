<?xml version="1.0" encoding="UTF-8" ?>

<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
   
      <title>ciwise.com</title>
   
   <link>http://ciwise.com</link>
   <description>Your dreams. Our design</description>
   <language>en-us</language>
   <managingEditor> David L. Whitehurst</managingEditor>
   <atom:link href="rss" rel="self" type="application/rss+xml" />
   
	<item>
	  <title>A Mule RESTful API Client Connector</title>
	  <link>//mule-restful-api-connector</link>
	  <author>David L. Whitehurst</author>
	  <pubDate>2016-01-09T21:06:19-05:00</pubDate>
	  <guid>//mule-restful-api-connector</guid>
	  <description><![CDATA[
	     <p>I&#39;ve recently been learning about the Mule ESB and Integration platform. I wanted to create my own custom connector to work with a RESTful API and use the data in a Mule flow. The connector was written to connect to an application created using a <a href="http://jhipster.github.io/">JHipster</a> Yeoman 
generator. The beauty of JHipster is the ability to generate a Spring-boot/AngularJS application quickly and also to generate entities with CRUD operations for persistence. JHipster&#39;s Angular(UI) layer uses Spring REST Controllers(Back-end) for it&#39;s CRUD operations. </p>

<p>I choose to create a general account entity in JHipster. The account has a String name and Long id. The connector will call the JHipster API e.g. /api/genaccounts and the returned listing of general accounts (JSON array) will be listed in the browser window using the Mule HTTP connector in the flow design.</p>

<p><img src="/assets/images/mule-3.jpg" alt="mules">
The connector project was created in AnyPoint Studio (Mule&#39;s Eclipse Environment) using 
the AnyPoint Connector Devkit that had to be downloaded and installed in AnyPoint. Devkit can be downloaded here https://docs.mulesoft.com/anypoint-connector-devkit/v/3.8/ . I used version 3.8. This may have changed since this writing. I obtained this software via the Eclipse update process using the IDE. Once I agreed to all the EULA&#39;s that MuleSoft provided, the software installed and I was ready to begin my new connector.</p>

<p>Since, I&#39;ve already created a working connector, I&#39;m going to create a new connector project and document everything as I implement the connector and test it. This way I&#39;ll be sure to note anything difficult or confusing as we go. Let&#39;s open AnyPoint Studio and create a new project. Select File/New/AnyPoint Connector Project or if the choice doesn&#39;t exist, select File/New/Other... and choose the Mule wizard and then select the AnyPoint Connector Project. Press the Next&gt; button to proceed. </p>

<p>The dialog that appears provides two choices for the type of connector project. You will want to select SDK Based and then the Next&gt; button to proceed. </p>

<p>The dialog that is now presented collects metadata for the project. This is where you will name the connector. My connector name is CIWiseREST. You do not have to add the text &quot;connector&quot;. The project generator will do this for you. Please notice that the project name and namespace text boxes will fill automatically as you name the connector itself. Be sure to select the &quot;Generate sample operations and configurable fields&quot; checkbox. We will use a very simple operation to prove that the connector will install and can be used in a Mule flow on a running server instance. The API Type is Java SDK and the Authentication drop down should be set to &quot;None&quot;. We will use authentication but we&#39;ll implement that
code ourselves. Nothing else should be checked. Select Next&gt;.</p>

<p>The dialog presented contains Maven and Github configuration information. We will unselect the Maven default checkbox and add information for the group-id as &quot;org.ciwise.modules&quot;. Select Next&gt;.</p>

<p>This last dialog provides for customization of the connector icon and also a text layer over the icon. I changed the label to read &quot;REST&quot;. That&#39;s it. We&#39;re done and can now select Finish. The code for the project will now be generated.</p>

<p>Two Java classes are generated:
- org.ciwise.modules.ciwiserest.CIWiseRESTConnector.java
- org.ciwise.modules.ciwiserest.config.ConnectorConfig.java</p>

<p>The connector class is called the @Connector class my the MuleSoft folks because this class must be annotated with @Connector. This is not optional. Mule has a code you don&#39;t see that allows the connector to be used in a drag-and-drop window and integrate with other connectors that make up a Mule flow. Here&#39;s a code listing of this class:</p>

<p><strong>Listing 1 - CIWiseRESTConnector.java</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">ciwise</span><span class="o">.</span><span class="na">modules</span><span class="o">.</span><span class="na">ciwiserest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.mule.api.annotations.Config</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mule.api.annotations.Connector</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.mule.api.annotations.Processor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.ciwise.modules.ciwiserest.config.ConnectorConfig</span><span class="o">;</span>

<span class="nd">@Connector</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;ci-wise-rest&quot;</span><span class="o">,</span> <span class="n">friendlyName</span><span class="o">=</span><span class="s">&quot;CIWiseREST&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CIWiseRESTConnector</span> <span class="o">{</span>

    <span class="nd">@Config</span>
    <span class="n">ConnectorConfig</span> <span class="n">config</span><span class="o">;</span>

    <span class="cm">/**</span>
<span class="cm">     * Custom processor</span>
<span class="cm">     *</span>
<span class="cm">     * @param friend Name to be used to generate a greeting message.</span>
<span class="cm">     * @return A greeting message</span>
<span class="cm">     */</span>
    <span class="nd">@Processor</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">greet</span><span class="o">(</span><span class="n">String</span> <span class="n">friend</span><span class="o">)</span> <span class="o">{</span>
        <span class="cm">/*</span>
<span class="cm">         * MESSAGE PROCESSOR CODE GOES HERE</span>
<span class="cm">         */</span>
        <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="na">getGreeting</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">friend</span> <span class="o">+</span> <span class="s">&quot;. &quot;</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="na">getReply</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">ConnectorConfig</span> <span class="nf">getConfig</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">config</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setConfig</span><span class="o">(</span><span class="n">ConnectorConfig</span> <span class="n">config</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">config</span> <span class="o">=</span> <span class="n">config</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>Let&#39;s build the connector and install it into AnyPoint Studio so we can test it with Mule. The connector project when created added the greet() method to the @Connector class because we checked the box to add an example operation. This operation is shown by the greet() method and annotated with the @Processor notation. When the Mule connector is selected in a Mule Project flow, the operations that have been annotated and defined, are selectable in the IDE to be processed during communications across the Mule flow in production. Select the project ci-wise-rest-connector in the Package explorer and right-mouse. Next select AnyPoint Connector at the bottom and then Build Connector. An Apache Maven build will commence. The project should build successfully.</p>

<p>To install the connector for testing, follow the same steps and when the final pop-up menu is shown, select Install or Update. The IDE will install and accept the connector for use when designing a Mule flow. A dialog should be shown when the installation is complete providing confirmation that the install was successful.</p>

<p>To test the connector using Mule, I created a Mule project called muletest. Open the Mule test project and drag an HTTP connector into the Mule Flow view. Set the properties of the connector to use localhost and port 8081. Next, find CIWiseREST in the Mule palette and drag your new connector into the flow beside te HTTP connector. Select your connector in the flow view and double-click. The connector properties window will be shown. Under Basic Settings/Connector Configuration, select the add or plus icon. Select &quot;CIWiseREST__Configuration&quot;. Now select the Operation drop-down and choose &quot;Greet&quot;. The greet method required an input string called friend and under General/Friend: you need to give the operation this String. Enter &quot;John&quot;. When we run the Mule application and give the browser the URL http://localhost:8081 we should expect to see &quot;Hello John. How are you?&quot;. That&#39;s it. It doesn&#39;t do much, however it demonstrates the @Connector and @Process annotations and how they are used with a Mule Flow. </p>

<p>Click in the Mule flow view and the little red X in the upper right of your connector should go away as there are no errors now. Press the Save All icon in the IDE. We are now ready to test our connector. Click on the Mule flow XML file in the Package Explorer and right-mouse. Choose Run-As/Mule Application. When Mule says it&#39;s deployed and successful, open a browser and enter http://localhost:8081. I see &quot;How are you? John. Hello&quot;. I set my configuration backwards. The return statement in the connector
operation method looks like this.</p>

<p><strong>Listing 2 - Snippet from CIWiseRESTConnector.java</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="nd">@Processor</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">greet</span><span class="o">(</span><span class="n">String</span> <span class="n">friend</span><span class="o">)</span> <span class="o">{</span>
        <span class="cm">/*</span>
<span class="cm">         * MESSAGE PROCESSOR CODE GOES HERE</span>
<span class="cm">         */</span>
        <span class="k">return</span> <span class="n">config</span><span class="o">.</span><span class="na">getGreeting</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot; &quot;</span> <span class="o">+</span> <span class="n">friend</span> <span class="o">+</span> <span class="s">&quot;. &quot;</span> <span class="o">+</span> <span class="n">config</span><span class="o">.</span><span class="na">getReply</span><span class="o">();</span>
    <span class="o">}</span></code></pre></figure>

<p>And, here&#39;s the source for the Configuration.</p>

<p><strong>Listing 3 - ConnectorConfig.java</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">ciwise</span><span class="o">.</span><span class="na">modules</span><span class="o">.</span><span class="na">ciwiserest</span><span class="o">.</span><span class="na">config</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.mule.api.annotations.components.Configuration</span><span class="o">;</span>

<span class="nd">@Configuration</span><span class="o">(</span><span class="n">friendlyName</span> <span class="o">=</span> <span class="s">&quot;Configuration&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConnectorConfig</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">reply</span> <span class="o">=</span> <span class="s">&quot;Hello&quot;</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">greeting</span> <span class="o">=</span> <span class="s">&quot;How are you?&quot;</span><span class="o">;</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getReply</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">reply</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getGreeting</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">greeting</span><span class="o">;</span>
    <span class="o">}</span>
    
<span class="o">}</span></code></pre></figure>

<p>The greeting should be &quot;Hello&quot; and the reply should be &quot;How are you?&quot;. Delete the connector from the Mule flow view. Swap the Strings, rebuild the connector, and then try to update the installation. I found that for some reason the Maven clean operation would not work. I&#39;m still trying to figure this out, but you can uninstall the connector, delete the target directory in a terminal or file explorer and then build the connector and install it successfully. Do this and re-test the connector using Mule. I just did and everything is fine now.</p>

<p>Now that I&#39;ve shown the Mule integration of the generated connector in the flow view, let&#39;s add a realistic operation to pull a simple list of accounts from a RESTful service and display the listing in the browser. I needed a simple service with a well documented API. My JHipster application will provide the RESTful service using Spring REST
controllers. It also provides a hosted Swagger API listing with the application. I created a simple entity object called &quot;genaccount&quot; with an id, and a String name. We&#39;ll use the JHipster /api/genaccounts call to get our listing.</p>

<p>To start we should create the packages for the client-side, connector entities. These objects will be used when Jackson deserializes the JSON that the JHipster application will send to our connector when we make the api call. Our project package base is org.ciwise.modules.ciwiserest. Create a &quot;base package&quot;.entities package. Before we call for the list of accounts, we must obtain a user authentication token. This token is sent
with all requests. We&#39;ll get the token and keep it in a private String member within the our Jersey client The token is obtained with the REST call /api/authenticate. The JHipster application returns a JSON object like so.</p>

<p><strong>Listing 4 - JSON return POST /api/authenticate</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">{</span>
  <span class="s2">&quot;expires&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s2">&quot;token&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span>
<span class="p">}</span></code></pre></figure>

<p>The accounts are just String names and this JSON model schema is like so.</p>

<p><strong>Listing 5 - JSON return GET /api/genaccounts</strong></p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="p">[</span>
  <span class="p">{</span>
    <span class="s2">&quot;acctno&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;accttype&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span>
    <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span>
  <span class="p">}</span>
<span class="p">]</span></code></pre></figure>

<p>Notice the square-brackets around the JSON object. This means that JHipster will be sending an array of JSON objects like the one defined in the curly-braces. I showed both API returns first because I wanted to show the simple data that the JHipster application is sending. On our end, within the connector, we don&#39;t generally use JSON. We want to be able to serialize and deserialize matching Java objects or Plain Old Java Objects (POJOs). And, looking at the JSON above, these Java classes will be very simple. And, why wouldn&#39;t we just create the classes, add the private members, and use Eclipse to create the get() and set() methods now? We&#39;re not going to do that because we need to also annotate the simple Java classes with Jackson 1.x annotations. And, we&#39;re going to use an online utility to generate the classes and annotate them from our JSON schema.</p>

<p>I wasn&#39;t familiar with the <a href="http://wiki.fasterxml.com/JacksonAnnotations">Jackson</a> annotations but I knew what the process did. And, there&#39;s a website called <a href="http://www.jsonschema2pojo.org/">JSONSchema2POJO</a> that will accept JSON schema or JSON and create the POJO classes we need. I&#39;m not going to discuss the operation of the site or how I created the files but I&#39;ll list them here for you to review.</p>

<p><strong>Listing 6 - Token.java</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">ciwise</span><span class="o">.</span><span class="na">modules</span><span class="o">.</span><span class="na">ciwiserest</span><span class="o">.</span><span class="na">entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.annotation.Generated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonAnyGetter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonAnySetter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonIgnore</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonProperty</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonPropertyOrder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.annotate.JsonSerialize</span><span class="o">;</span>

<span class="cm">/**</span>
<span class="cm"> * POJO for mapping with JSON response api/authenticate</span>
<span class="cm"> * </span>
<span class="cm"> * @author David L. Whitehurst</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="nd">@JsonSerialize</span><span class="o">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">JsonSerialize</span><span class="o">.</span><span class="na">Inclusion</span><span class="o">.</span><span class="na">NON_NULL</span><span class="o">)</span>
<span class="nd">@Generated</span><span class="o">(</span><span class="s">&quot;org.jsonschema2pojo&quot;</span><span class="o">)</span>
<span class="nd">@JsonPropertyOrder</span><span class="o">({</span> <span class="s">&quot;expires&quot;</span><span class="o">,</span> <span class="s">&quot;token&quot;</span> <span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Token</span> <span class="o">{</span>

    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;expires&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Object</span> <span class="n">expires</span><span class="o">;</span>
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Object</span> <span class="n">token</span><span class="o">;</span>
    <span class="nd">@JsonIgnore</span>
    <span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">additionalProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>

    <span class="cm">/**</span>
<span class="cm">    * </span>
<span class="cm">    * @return The expires</span>
<span class="cm">    */</span>
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;expires&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getExpires</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">expires</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">    * </span>
<span class="cm">    * @param expires</span>
<span class="cm">    *            The expires</span>
<span class="cm">    */</span>
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;expires&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setExpires</span><span class="o">(</span><span class="n">Object</span> <span class="n">expires</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">expires</span> <span class="o">=</span> <span class="n">expires</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">    * </span>
<span class="cm">    * @return The token</span>
<span class="cm">    */</span>
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getToken</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">token</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**</span>
<span class="cm">    * </span>
<span class="cm">    * @param token</span>
<span class="cm">    *            The token</span>
<span class="cm">    */</span>
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;token&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setToken</span><span class="o">(</span><span class="n">Object</span> <span class="n">token</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">token</span> <span class="o">=</span> <span class="n">token</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@JsonAnyGetter</span>
    <span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getAdditionalProperties</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">additionalProperties</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@JsonAnySetter</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAdditionalProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">additionalProperties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p><strong>Listing 7 - Account.java</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">ciwise</span><span class="o">.</span><span class="na">modules</span><span class="o">.</span><span class="na">ciwiserest</span><span class="o">.</span><span class="na">entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.annotation.Generated</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonAnyGetter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonAnySetter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonIgnore</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonProperty</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.annotate.JsonPropertyOrder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.annotate.JsonSerialize</span><span class="o">;</span>

<span class="nd">@JsonSerialize</span><span class="o">(</span><span class="n">include</span> <span class="o">=</span> <span class="n">JsonSerialize</span><span class="o">.</span><span class="na">Inclusion</span><span class="o">.</span><span class="na">NON_NULL</span><span class="o">)</span>
<span class="nd">@Generated</span><span class="o">(</span><span class="s">&quot;org.jsonschema2pojo&quot;</span><span class="o">)</span>
<span class="nd">@JsonPropertyOrder</span><span class="o">({</span>
<span class="s">&quot;acctno&quot;</span><span class="o">,</span>
<span class="s">&quot;id&quot;</span><span class="o">,</span>
<span class="s">&quot;name&quot;</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="o">{</span>

<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;acctno&quot;</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">acctno</span><span class="o">;</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
<span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
<span class="nd">@JsonIgnore</span>
<span class="kd">private</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="n">additionalProperties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;();</span>

<span class="cm">/**</span>
<span class="cm">* </span>
<span class="cm">* @return</span>
<span class="cm">* The acctno</span>
<span class="cm">*/</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;acctno&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAcctno</span><span class="o">()</span> <span class="o">{</span>
<span class="k">return</span> <span class="n">acctno</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm">* </span>
<span class="cm">* @param acctno</span>
<span class="cm">* The acctno</span>
<span class="cm">*/</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;acctno&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAcctno</span><span class="o">(</span><span class="kt">int</span> <span class="n">acctno</span><span class="o">)</span> <span class="o">{</span>
<span class="k">this</span><span class="o">.</span><span class="na">acctno</span> <span class="o">=</span> <span class="n">acctno</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm">* </span>
<span class="cm">* @return</span>
<span class="cm">* The id</span>
<span class="cm">*/</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
<span class="k">return</span> <span class="n">id</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm">* </span>
<span class="cm">* @param id</span>
<span class="cm">* The id</span>
<span class="cm">*/</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm">* </span>
<span class="cm">* @return</span>
<span class="cm">* The name</span>
<span class="cm">*/</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
<span class="k">return</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm">* </span>
<span class="cm">* @param name</span>
<span class="cm">* The name</span>
<span class="cm">*/</span>
<span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@JsonAnyGetter</span>
<span class="kd">public</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Object</span><span class="o">&gt;</span> <span class="nf">getAdditionalProperties</span><span class="o">()</span> <span class="o">{</span>
<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">additionalProperties</span><span class="o">;</span>
<span class="o">}</span>

<span class="nd">@JsonAnySetter</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAdditionalProperty</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Object</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
<span class="k">this</span><span class="o">.</span><span class="na">additionalProperties</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
<span class="o">}</span>

<span class="o">}</span></code></pre></figure>

<p>The next step is to create a package for any exceptions our client class might encounter. Create a package &quot;base-package&quot;.exception and the following classes to extend Exception:</p>

<ul>
<li>CIWiseRESTConnectorException</li>
<li>CIWiseRESTConnectorTokenExpiredException</li>
</ul>

<p>I&#39;m going to assume you don&#39;t need to see these, but you will need them. Now, we&#39;ll create the real nuts and bolts of the connector, the client class.</p>

<p>Create a package &quot;base-package&quot;.client and then create a class called RestClient. This class will implement the Jersey-client. I&#39;ll discuss the pieces of the class and share snippets as we go.</p>

<p>The connector class needs two public methods. These are:</p>

<p>*<em>Listing 8 - RestClient (public methods signatures) *</em></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    
    <span class="kd">public</span> <span class="n">Token</span> <span class="nf">getXAuthToken</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CIWiseRESTConnectorException</span><span class="o">,</span>
        <span class="n">CIWiseRESTConnectorTokenExpiredException</span> <span class="o">{</span>
        <span class="n">WebResource</span> <span class="n">webResource</span> <span class="o">=</span> <span class="n">getApiResource</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">&quot;api&quot;</span><span class="o">).</span><span class="na">path</span><span class="o">(</span>
                <span class="s">&quot;authenticate&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">executeAuthenticationPost</span><span class="o">(</span><span class="n">webResource</span><span class="o">,</span> <span class="n">Token</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">public</span> <span class="n">Account</span><span class="o">[]</span> <span class="nf">getAccounts</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CIWiseRESTConnectorException</span><span class="o">,</span>
    <span class="n">CIWiseRESTConnectorTokenExpiredException</span> <span class="o">{</span>

        <span class="n">WebResource</span> <span class="n">webResource</span> <span class="o">=</span> <span class="n">getApiResource</span><span class="o">().</span><span class="na">path</span><span class="o">(</span><span class="s">&quot;api&quot;</span><span class="o">).</span><span class="na">path</span><span class="o">(</span>
        <span class="s">&quot;genaccounts&quot;</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">execute</span><span class="o">(</span><span class="n">webResource</span><span class="o">,</span> <span class="s">&quot;GET&quot;</span><span class="o">,</span> <span class="n">Account</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span></code></pre></figure>

<p>We should talk about the connector class now and how it uses these methods to accomplish its goals. I&#39;ll address the connector lifecycle and how it relates to the Java annotations. Ultimately our goal is to run the Mule connector operation &quot;Get Accounts&quot;. We select that operation in the properties dialog for the custom connector in our Mule flow. This operation is defined here in the connector class.</p>

<p><strong>Listing 9 - CIWiseRESTConnector (key process method)</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="nd">@Processor</span><span class="o">(</span><span class="n">friendlyName</span><span class="o">=</span><span class="s">&quot;Get Accounts&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAccounts</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CIWiseRESTConnectorException</span><span class="o">,</span> <span class="n">CIWiseRESTConnectorTokenExpiredException</span> <span class="o">{</span>
        <span class="n">Account</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">getClient</span><span class="o">().</span><span class="na">getAccounts</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">retStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
        <span class="o">{</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="n">retStr</span> <span class="o">+</span> <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getAcctno</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
            
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="n">retStr</span><span class="o">;</span>
    <span class="o">}</span></code></pre></figure>

<p>Before the String listing of account names can be returned, the connector needs to be instantiated and then the lifecycle process begins. When the connector class is instantiated, a configuration class is also created and the configuration data is then available to the connector for whatever it needs. Next, the @Start annotation is inspected and the initialization method is processed.</p>

<p><strong>Listing 10 - CIWiseRESTConnector (@Start event)</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="nd">@Start</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">setClient</span><span class="o">(</span><span class="k">new</span> <span class="nf">RestClient</span><span class="o">(</span><span class="k">this</span><span class="o">));</span>
    <span class="o">}</span>    </code></pre></figure>

<p>When the start event is processed, our client class gets created and the connector instance is passed in, giving access to the configuration data to the client. The Mule documentation calls is wrapping the client, but not exactly. It&#39;s not the Decorator pattern where the wrapper class provides a different class signature but with very little functionality. After the @Start annotation, the @Process operation that was selected in the connector&#39;s property dialog will be executed. I created an @Process method for getting the X-Auth token but only used it for testing. The next method called after @Start is getAccounts() (annotated with @Process).</p>

<p><strong>Listing 11 - CIWiseRESTConnector (@Process event)</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="nd">@Processor</span><span class="o">(</span><span class="n">friendlyName</span><span class="o">=</span><span class="s">&quot;Get Accounts&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getAccounts</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">CIWiseRESTConnectorException</span><span class="o">,</span> <span class="n">CIWiseRESTConnectorTokenExpiredException</span> <span class="o">{</span>
        <span class="n">Account</span><span class="o">[]</span> <span class="n">array</span> <span class="o">=</span> <span class="n">getClient</span><span class="o">().</span><span class="na">getAccounts</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">retStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span>
        <span class="o">{</span>
            <span class="n">retStr</span> <span class="o">=</span> <span class="n">retStr</span> <span class="o">+</span> <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getId</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;,&quot;</span> <span class="o">+</span> <span class="n">array</span><span class="o">[</span><span class="n">i</span><span class="o">].</span><span class="na">getAcctno</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;\n&quot;</span><span class="o">;</span>
            
        <span class="o">}</span>
        
        <span class="k">return</span> <span class="n">retStr</span><span class="o">;</span>
    <span class="o">}</span></code></pre></figure>
 

<p>The connector calls getAccounts(), the client calls its getAccounts() and our client gets an array of Account Java objects. We can iterate over them and return a textual list of accounts to our browser when our connector is in use. The real work happens in the RestClient class. I&#39;ll describe things there now.</p>

<p>I&#39;ll start with the getAccounts() method in the client class. It calls upon the private method execute(). I&#39;ll provide the listing here.</p>

<p><strong>Listing 12 - RestClient (execute())</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="cm">/**</span>
<span class="cm">    * Executes an API request</span>
<span class="cm">    *</span>
<span class="cm">    */</span>
    <span class="kd">private</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">execute</span><span class="o">(</span><span class="n">WebResource</span> <span class="n">webResource</span><span class="o">,</span> <span class="n">String</span> <span class="n">method</span><span class="o">,</span>
            <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">returnClass</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">CIWiseRESTConnectorTokenExpiredException</span><span class="o">,</span>
            <span class="n">CIWiseRESTConnectorException</span> <span class="o">{</span>

        <span class="cm">/**</span>
<span class="cm">        * Call HTTP Method</span>
<span class="cm">        */</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">connector</span><span class="o">.</span><span class="na">getToken</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">Token</span> <span class="n">token</span> <span class="o">=</span> <span class="n">getXAuthToken</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">token</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">connector</span><span class="o">.</span><span class="na">setToken</span><span class="o">((</span><span class="n">String</span><span class="o">)</span> <span class="n">token</span><span class="o">.</span><span class="na">getToken</span><span class="o">());</span> 
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="n">ClientResponse</span> <span class="n">clientResponse</span> <span class="o">=</span> <span class="n">webResource</span><span class="o">.</span><span class="na">accept</span><span class="o">(</span>
                <span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">).</span><span class="na">header</span><span class="o">(</span><span class="s">&quot;X-Auth-Token&quot;</span><span class="o">,</span> <span class="n">connector</span><span class="o">.</span><span class="na">getToken</span><span class="o">())</span>
                <span class="o">.</span><span class="na">method</span><span class="o">(</span><span class="n">method</span><span class="o">,</span> <span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">clientResponse</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="mi">200</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">clientResponse</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">returnClass</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">clientResponse</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="mi">401</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">CIWiseRESTConnectorTokenExpiredException</span><span class="o">(</span>
                    <span class="s">&quot;The access token has expired; &quot;</span>
                            <span class="o">+</span> <span class="n">clientResponse</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">CIWiseRESTConnectorException</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                    <span class="s">&quot;ERROR - statusCode: %d - message: %s&quot;</span><span class="o">,</span>
                    <span class="n">clientResponse</span><span class="o">.</span><span class="na">getStatus</span><span class="o">(),</span>
                    <span class="n">clientResponse</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)));</span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre></figure>
 

<p>You will notice that the initial logic is to check the connector for a not-null token. And, since we&#39;re calling the getAccounts() method, we won&#39;t have one. So we must get the token. The token comes by way of the executeAuthenticationPost() method that&#39;s somewhat similar to the execute() method. Its listing is here.</p>

<p><strong>Listing 13 - RestClient (executeAuthenticationPost())</strong></p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="cm">/**</span>
<span class="cm">    * Executes an authentication request via HTTP POST</span>
<span class="cm">    *</span>
<span class="cm">    */</span>
    
    <span class="kd">private</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="nf">executeAuthenticationPost</span><span class="o">(</span><span class="n">WebResource</span> <span class="n">webResource</span><span class="o">,</span>
            <span class="n">Class</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">returnClass</span><span class="o">)</span>
            <span class="kd">throws</span> <span class="n">CIWiseRESTConnectorTokenExpiredException</span><span class="o">,</span>
            <span class="n">CIWiseRESTConnectorException</span> <span class="o">{</span>

        <span class="c1">// Map query params for POST operation MultivaluedMap, MultivaluedMapImpl</span>
        
        <span class="n">MultivaluedMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">queryParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">MultivaluedMapImpl</span><span class="o">();</span>
        <span class="n">queryParams</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;username&quot;</span><span class="o">,</span>
                <span class="n">getConnector</span><span class="o">().</span><span class="na">getConfig</span><span class="o">().</span><span class="na">getUsername</span><span class="o">());</span>
        <span class="n">queryParams</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span>
                <span class="n">getConnector</span><span class="o">().</span><span class="na">getConfig</span><span class="o">().</span><span class="na">getPassword</span><span class="o">());</span>

        <span class="cm">/**</span>
<span class="cm">        * Call HTTP POST</span>
<span class="cm">        */</span>
        <span class="n">ClientResponse</span> <span class="n">clientResponse</span> <span class="o">=</span> <span class="n">webResource</span><span class="o">.</span><span class="na">queryParams</span><span class="o">(</span><span class="n">queryParams</span><span class="o">)</span>
                <span class="o">.</span><span class="na">accept</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">).</span><span class="na">post</span><span class="o">(</span><span class="n">ClientResponse</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">clientResponse</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="mi">200</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">clientResponse</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">returnClass</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">clientResponse</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()</span> <span class="o">==</span> <span class="mi">401</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">CIWiseRESTConnectorTokenExpiredException</span><span class="o">(</span>
                    <span class="s">&quot;The access token has expired; &quot;</span>
                            <span class="o">+</span> <span class="n">clientResponse</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">CIWiseRESTConnectorException</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span>
                    <span class="s">&quot;ERROR - statusCode: %d - message: %s&quot;</span><span class="o">,</span>
                    <span class="n">clientResponse</span><span class="o">.</span><span class="na">getStatus</span><span class="o">(),</span>
                    <span class="n">clientResponse</span><span class="o">.</span><span class="na">getEntity</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">)));</span>
        <span class="o">}</span>
    <span class="o">}</span></code></pre></figure>
 

<p>In this method we send the username and password on an HTTP POST request, in query parameters and the client response object populates the returnClass (Token.java). We never see the JSON deserialization because of the Jackson 1.x annotations on our entity objects. Once we have the token, we save the String token to be part of our /api/genaccounts request next. In listing 12 you will notice that we place the key &quot;X-Auth-Token&quot; and the actual token value on the HTTP header. We make the call and the same JSON deserialization into our Account object(s) occurs. This time the returnClass is Account[].class or an array of Account objects. This is what we needed to display our list of accounts.</p>

<p>You can check out my entire connector project at: <a href="https://github.com/ciwise/ci-wise-rest-connector">CIWiseRESTConnector</a> </p>

	  ]]></description>
	</item>

	<item>
	  <title>Enterprise Open Source Consulting</title>
	  <link>//enterprise-open-source-consulting</link>
	  <author>David L. Whitehurst</author>
	  <pubDate>2016-01-09T21:06:19-05:00</pubDate>
	  <guid>//enterprise-open-source-consulting</guid>
	  <description><![CDATA[
	     <p>We are hindered today by nothing but our imagination as it relates to computers and technology. Open source continues to provide cookbook solutions 
to almost every imaginable problem encountered in business or home life. The sheer collection of this software is so immense that the reason people 
continue to buy proprietary software is only because they either don&#39;t know of the open source solution or think it&#39;s inferior. Cost is still a 
factor because open source has a steep learning curve. Time is money and that&#39;s where we come in. An open source enterprise consultant can introduce your 
business to fantastic new technologies that can improve your bottom line. They can lead your development staff into new territory, improving your 
overall development, testing, continuous integration, deployment, and agility. Contact us at david@ciwise.com or call 919-605-6529.</p>

	  ]]></description>
	</item>


</channel>
</rss>
